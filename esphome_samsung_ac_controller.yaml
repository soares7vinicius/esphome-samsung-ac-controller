esphome:
  name: officeroom
  libraries:
    - IRremoteESP8266
    - IRremoteESP8266@^2.8.6

esp32:
  board: esp32doit-devkit-v1
  framework:
    type: arduino

# Enable logging
logger:
  level: DEBUG
  logs:
    climate.samsung_ac_ir: INFO
    samsung_ac_sniffer: INFO
    sensor: INFO

# Enable Home Assistant API
api:
  password: "5533"

ota:
  - platform: esphome
    password: "5533"

wifi:
  networks:
    - ssid: "VINICIUS"
      password: "33221540"
    - ssid: "Casa Do Kinka"
      password: "33221540"

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Officeroom Fallback Hotspot"
    password: "wlQo86PsmTfc"

captive_portal:

web_server:
  port: 80

output:
  - platform: gpio
    pin: 18
    id: led_output

light:
  - platform: binary
    name: "Office Room Light"
    output: led_output
    id: office_room_light

text_sensor:
  # Para mapear botões sem entupir o log com RAW, publicamos o Pronto completo no HA.
  - platform: template
    name: "Office Room Last IR Pronto"
    id: last_ir_pronto
    update_interval: never

script:
  # Mantém o LED (GPIO18) aceso enquanto houver tráfego IR chegando.
  # Como o script é `restart`, cada frame recebido reinicia o timer.
  - id: ir_rx_activity
    mode: restart
    then:
      - light.turn_on: office_room_light
      - delay: 350ms
      - light.turn_off: office_room_light

external_components:
  - source:
      type: local
      path: components

samsung_ac_sniffer:
  id: samsung_sniffer
  rx_pin: 21
  dump_raw: true
  dump_state: true
  dump_desc: true
  rate_limit_ms: 500
  buffer_size: 2048
  timeout_ms: 90
  tolerance_percent: 20
  min_unknown_size: 300   # ajusta para filtrar ruído curto


climate:
  - platform: samsung_ac_ir
    name: "Office Room AC"
    id: office_room_ac
    ir_pin: 4
    supports_swing_horizontal: true
    supports_swing_vertical: true


i2c:
  sda: 32
  scl: 33
  scan: true

sensor:
  - platform: bmp280_i2c
    address: 0x76
    # model: BME280
    temperature:
      name: "Office Room Temperature"
      id: office_room_temperature
      on_value:
        then:
          - logger.log:
              format: "Temp: %.1f °C"
              args: [x]
    # humidity:
    #   name: "Office Room Humidity"
    #   id: office_room_humidity
    #   on_value:
    #     then:
    #       - logger.log:
    #           format: "Hum: %.1f %%"
    #           args: [x]
    pressure:
      name: "Office Room Pressure"
      id: office_room_pressure
    update_interval: 10s
